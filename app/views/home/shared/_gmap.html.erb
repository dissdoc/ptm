<script type="text/javascript">
    var markers = [];

    var latlng = new google.maps.LatLng(-34.397, 150.644);
    var myOptions = {
        zoom: 0,
        center: latlng,
        mapTypeId:google.maps.MapTypeId.ROADMAP,
        streetViewControl: false,
        mapTypeControl: false
    }

    var map = new google.maps.Map(document.getElementById("fullmap"), myOptions);
    google.maps.event.addListener(map, 'idle', getBounds);

    <% photos.each do |photo| %>
        <% if photo.geo.present? %>
            <% if photo.geo.latitude.present? && photo.geo.longitude.present? %>
            var latlng = new google.maps.LatLng("<%= photo.geo.latitude %>", "<%= photo.geo.longitude %>");
            var marker = new google.maps.Marker({
                position: latlng
            });
            markers.push(marker);
            <% end %>
        <% end %>
    <% end %>

    markerClusterer = new MarkerClusterer(map, markers, {
        maxZoom: 18,
        gridSize: 50,
        styles: null
    });

    function getBounds() {
        var currentBounds = map.getBounds();
        var ne_lng = currentBounds.getNorthEast().lng();
        var ne_lat = currentBounds.getNorthEast().lat();
        var sw_lng = currentBounds.getSouthWest().lng();
        var sw_lat = currentBounds.getSouthWest().lat();

        var current = currentBounds.getNorthEast();
        var center = map.getCenter();

        //$.post("<%= photos_refresh_path %>",
        //    { ne_lng: ne_lng, ne_lat: ne_lat,
        //      sw_lng: sw_lng, sw_lat: sw_lat,
        //      lat: center.lat(), lng: center.lng() });
    }
</script>